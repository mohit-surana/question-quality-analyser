Rootkits
        Hit list: The attacker first compiles a long list of potential vulnerable machines.
         This can be a slow process done over a long period to avoid detection that an
         attack is underway. Once the list is compiled, the attacker begins infecting
         machines on the list. Each infected machine is provided with a portion of the
         list to scan. This strategy results in a very short scanning period, which may
         make it difficult to detect that infection is taking place.
        Topological: This method uses information contained on an infected victim
         machine to find more hosts to scan.
        Local subnet: If a host can be infected behind a firewall, that host then looks
         for targets in its own local network. The host uses the subnet address structure
         to find other hosts that would otherwise be protected by the firewall.
14.6  ROOTKITS
      A rootkit is a set of programs installed on a system to maintain administrator (or
      root) access to that system. Root access provides access to all the functions and
      services of the operating system. The rootkit alters the host's standard functionality
      in a malicious and stealthy way. With root access, an attacker has complete control
      of the system and can add or change programs and files, monitor processes, send
      and receive network traffic, and get backdoor access on demand.
         A rootkit can make many changes to a system to hide its existence, mak-
      ing it difficult for the user to determine that the rootkit is present and to iden-
      tify what changes have been made. In essence, a rootkit hides by subverting the
      mechanisms that monitor and report on the processes, files, and registries on a
      computer.
         Rootkits can be classified based on whether they can survive a reboot and
      execution mode. A rootkit may be
        Persistent: Activates each time the system boots. The rootkit must store code
         in a persistent store, such as the registry or file system, and configure a method
         by which the code executes without user intervention.
        Memory based: Has no persistent code and therefore cannot survive a reboot
        User mode: Intercepts calls to APIs (Application Program Interfaces) and mod-
         ifies returned results. For example, when an application performs a directory
         listing, the return results don't include entries identifying the files associated
         with the rootkit.
        Kernel mode: Can intercept calls to native APIs in kernel mode. The root-
         kit can also hide the presence of a malware process by removing it from the
         kernel's list of active processes.
      Rootkit Installation
      Unlike worms or bots, rootkits do not directly rely on vulnerabilities or exploits
      to get on a computer. One method of rootkit installation is via a Trojan horse pro-
      gram. The user is induced to load the Trojan horse, which then installs the rootkit.

     Another means of rootkit installation is by hacker activity. The following sequence
     is representative of a hacker attack to install a rootkit [GEER06].
     1.      The attacker uses a utility to identify open ports or other vulnerabilities.
     2.      The attacker uses password cracking, malware, or a system vulnerability to
             gain initial access and, eventually, root access.
     3.      The attacker uploads the rootkit to the victim's machine.
     4.      The attacker can add a virus, denial of service, or other type of attack to the
             rootkit's payload.
     5.      The attacker then runs the rootkit's installation script.
     6.      The rootkit replaces binaries, files, commands, or system utilities to hide its
             presence.
     7.      The rootkit listens at a port in the target server, installs sniffers or keyloggers,
             activates a malicious payload, or takes other steps to compromise the victim.
     System-Level Call Attacks
     Programs operating at the user level interact with the kernel through system calls.
     Thus, system calls are a primary target of kernel-level rootkits to achieve conceal-
     ment. As an example of how rootkits operate, we look at the implementation of
     system calls in Linux. In Linux, each system call is assigned a unique syscall number.
     When a user-mode process executes a system call, the process refers to the system
     call by this number. The kernel maintains a system call table with one entry per
     system call routine; each entry contains a pointer to the corresponding routine. The
     syscall number serves as an index into the system call table.
             [LEVI06] lists three techniques that can be used to change system calls:
            Modify the system call table: The attacker modifies selected syscall addresses
             stored in the system call table. This enables the rootkit to direct a system call
             away from the legitimate routine to the rootkit's replacement. Figure 14.6
             shows how the knark rootkit achieves this.
            Modify system call table targets: The attacker overwrites selected legitimate
             system call routines with malicious code. The system call table is not changed.
     System call table                             System call table      knark_fork( )
                                                                          knark_read( )
                                                                          knark_execve( )
     #2                                                  #2
     #3                                                  #3
     #11                              sys_fork( )        #11                             sys_fork( )
     #12                              sys_read( )        #12                             sys_read( )
                                 sys_execve( )                            sys_execve( )
                                 sys_chdir( )                             sys_chdir( )
     (a) Normal kernel memory layout                            (b) After knark install
Figure 14.6  System Call Table Modification by Rootkit

          Redirect the system call table: The attacker redirects references to the entire
           system call table to a new table in a new kernel memory location.
14.6    RECOMMENDED READING AND WEB SITES
        The topics in this chapter are covered in more detail in [STAL08]. It is useful to
        read some of the classic tutorial papers on computer security; these provide a his-
        torical perspective from which to appreciate current work and thinking. The papers
        to read are [WARE79], [BROW72], [SALT75], [SHAN77], and [SUMM84]. Two
        more recent short treatments of computer security are [ANDR04] and [LAMP04].
        [NIST95] is an exhaustive (290 pages) treatment of the subject. Another good treat-
        ment is [NRC91]. Also useful is [FRAS97].
ANDR04  Andrews, M., and Whittaker, J. "Computer Security." IEEE Security and Privacy,
      September/October 2004.
BROW72     Browne, P. "Computer Security--A Survey." ACM SIGMIS Database, Fall 1972.
FRAS97  Fraser, B. Site Security Handbook. RFC 2196, September 1997.
LAMP04  Lampson, B. "Computer Security in the Real World." Computer, June 2004.
NIST95  National Institute of Standards and Technology. An Introduction to Computer Security:
      The NIST Handbook. Special Publication 800-12. October 1995.
NRC91   National Research Council. Computers at Risk: Safe Computing in the Information Age.
      Washington, DC: National Academy Press, 1991.
SALT75  Saltzer, J., and Schroeder, M. "The Protection of Information in Computer Systems."
      Proceedings of the IEEE, September 1975.
SHAN77  Shanker, K. "The Total Computer Security Problem: An Overview." Computer, June 1977.
STAL08  Stallings, W., and Brown L. Computer Security: Principles and Practice. Upper Saddle
      River, NJ: Prentice Hall, 2008.
SUMM84     Summers, R. "An Overview of Computer Security." IBM Systems Journal, Vol. 23,
      No. 4, 1984.
WARE79     Ware, W., ed. Security Controls for Computer Systems. RAND Report 609-1,
      October 1979. http://www.rand.org/pubs/reports/R609-1/index2.html
        Recommended Web sites:
          Computer Security Resource Center: Maintained by the National Institute on Stan-
           dards and Technology (NIST). Contains a broad range of information on security
           threats, technology, and standards.
          CERT Coordination Center: The organization that grew from the computer emergency
           response team formed by the Defense Advanced Research Projects Agency. Site provides
           good information on Internet security threats, vulnerabilities, and attack statistics.
          Vmyths: Dedicated to exposing virus hoaxes and dispelling misconceptions about real
           viruses.
